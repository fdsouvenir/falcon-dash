# Ralph Progress Log — falcon-dash Phase 1: Core Infrastructure
Started: 2026-02-08
Branch: ralph/phase-1-core-infrastructure

## Codebase Patterns
- SvelteKit 2 with Svelte 4 (NOT Svelte 5) — use `on:event`, `export let`, `$:` syntax
- `@sveltejs/vite-plugin-svelte@^3` is required for Svelte 4 compat (v4+ needs Svelte 5)
- `vite@^5` is required (not v6+) for vite-plugin-svelte v3 compat
- `eslint@^9` is required (not v10) for eslint-plugin-svelte compat
- ESLint uses flat config (eslint.config.js), NOT legacy .eslintrc
- Prettier config: tabs, singleQuote, trailingComma: "none"
- Folder structure: src/lib/gateway/, stores/, components/, utils/
- Tailwind CSS 3 via postcss.config.js + tailwind.config.js
- Build warnings about `untrack`/`fork`/`settled` are harmless (SvelteKit 2.50+ has Svelte 5 imports but works fine with Svelte 4)

---

## 2026-02-08 - US-001
- Scaffolded SvelteKit 2 + Svelte 4 + TypeScript project
- Configured Tailwind CSS 3 with PostCSS + autoprefixer
- Configured ESLint 9 with svelte plugin + typescript-eslint (flat config)
- Configured Prettier: tabs, single quotes, no trailing commas
- Created folder structure: src/lib/gateway/, stores/, components/, utils/
- Files created: package.json, svelte.config.js, vite.config.ts, tsconfig.json, eslint.config.js, .prettierrc, .prettierignore, postcss.config.js, tailwind.config.js, src/app.html, src/app.css, src/app.d.ts, src/routes/+layout.svelte, src/routes/+page.svelte
- **Learnings for future iterations:**
  - Must pin @sveltejs/vite-plugin-svelte@^3 for Svelte 4 (v4+ requires Svelte 5)
  - Must pin vite@^5 for vite-plugin-svelte v3
  - Must pin eslint@^9 (v10 conflicts with eslint-plugin-svelte)
  - `npm create svelte@latest` (sv create) is interactive, not scriptable — scaffold manually
- Playwright E2E: tests/ dir at project root, playwright.config.ts at root
- Smoke test: listen for console errors, assert 200 + body exists

---

## 2026-02-08 - US-016
- Installed @playwright/test, chromium only
- Created playwright.config.ts: webServer on port 5173, chromium only, headless
- Created tests/smoke.test.ts: navigates to /, listens for console errors, asserts 200 + body
- Added "test": "playwright test" to package.json scripts
- All quality gates pass: check, lint, build, format, test
- **Learnings for future iterations:**
  - Playwright chromium was already cached, `npx playwright install chromium` is idempotent
  - Test runs in ~6s with cold server start
---

## 2026-02-08 - US-002
- Created src/lib/gateway/types.ts with full protocol type definitions
- Types: ConnectionState enum, Frame types (req/res/event), GatewayError, ConnectParams, ClientInfo, AuthParams, DeviceParams
- Types: HelloOkPayload with server, features, policy, snapshot, auth
- Types: AgentEvent union (thinking, tool_start, tool_result, text_delta, text_end)
- Types: ShutdownPayload, GatewayConfig
- Added test-results/ to .gitignore and .prettierignore
- **Learnings for future iterations:**
  - Keep types close to ws-protocol.md shapes
  - ClientInfo.id is literal type 'openclaw-control-ui' (gateway validates)
---
