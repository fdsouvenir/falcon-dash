# Ralph Progress Log
Started: Sun Feb  8 02:55:07 PM CST 2026
---

## Codebase Patterns

### PM Store Pattern
- Store file: `src/lib/stores/pm.ts`
- Writable stores for each entity: `pmDomains`, `pmFocuses`, `pmMilestones`, `pmProjects`, `pmTasks`, `pmComments`, `pmActivities`, `pmStats`, `pmBlocks`, `pmAttachments`
- Load functions accept optional filter params and use `gateway.call<ResponseType>('pm.entity.method', params)`
- Optimistic updates: update store immediately, call gateway, revert on error (try/catch pattern)
- `handleEntityEvent<T>()` generic function handles create/update/delete for all entity types
- `handlePmEvent()` dispatches by `entityType` using switch/case
- stateVersion gap detection: if incoming version > current + 1, refetch all entities
- `initPmListeners()`/`destroyPmListeners()` pattern matches cron store
- Params cast to `Record<string, unknown>` for gateway.call compatibility

### PM Component Pattern
- Components live in `src/lib/components/pm/` with barrel export from `index.ts`
- PmSidebar: secondary navigation within `/projects` route (not main app sidebar)
- Props for selection state: `selectedDomainId`, `selectedFocusId` — dispatches `select` event
- Inline forms for create/edit with Enter to submit, Escape to cancel
- Hover-reveal action buttons using Tailwind `group`/`group-hover` + `opacity-0`/`group-hover:opacity-100`
- Nested group hover: use `group/name` syntax for focus items inside domain group
- ConfirmDialog reused from Phase 3 files module
- Svelte `class:hover:bg-*` directives: do NOT use Tailwind opacity modifiers (`/60`) — Prettier fails. Use solid colors like `bg-slate-800` instead

### PM Dashboard Route Pattern
- Route at `/projects` with `ssr: false` in `+page.ts`
- `onMount`: call `initPmListeners()` + parallel data loads via `Promise.all`
- `onDestroy`: call `destroyPmListeners()`
- TypeScript casts in Svelte templates: NEVER use `as Type` inside `{expressions}` — Prettier fails. Use helper functions to cast in the `<script>` block instead.
- Reactive derived data: `$:` declarations filter/sort store data for sections

### PM Types Pattern
- Entity types prefixed with `Pm`: `PmDomain`, `PmFocus`, `PmProject`, etc.
- Method param/response types: `Pm{Group}{Action}Params` / `Pm{Group}{Action}Response`
- Single-entity returns use the entity type directly (no wrapper response)
- Enums: `PmStatus` (6 values), `PmPriority` (4 values)
- Barrel exports from `src/lib/types/index.ts` — enums use value export, interfaces use `export type`
- PmEvent carries `stateVersion: { pm: number }` for gap detection

---

## 2026-02-08 - US-051
- Created `src/lib/types/pm.ts` with all PM entity interfaces, enums, event types, and method param/response types
- Updated `src/lib/types/index.ts` barrel export with all PM type exports
- Files changed: `src/lib/types/pm.ts` (new), `src/lib/types/index.ts`
- **Learnings for future iterations:**
  - ~45 method types across 13 groups — comprehensive coverage done
  - `PmTargetType` ('project' | 'task') reused across Comment, Block, Attachment params
  - `PmEntity` union type useful for PmEvent payload typing

## 2026-02-08 - US-052
- Created `src/lib/stores/pm.ts` with full PM store layer: 10 writable stores, CRUD functions for all entities, event listeners, search, bulk operations
- Updated `src/lib/stores/index.ts` barrel exports with all PM store exports
- Files changed: `src/lib/stores/pm.ts` (new), `src/lib/stores/index.ts`
- **Learnings for future iterations:**
  - Generic `handleEntityEvent<T>()` reduces boilerplate for create/update/delete across all entity types
  - Block entity has no `id` — uses `blockerId`+`blockedId` compound key for filtering
  - `loadTasks(projectId)` merges new tasks while preserving tasks from other projects in the store
  - Optimistic updates pattern: save prev value, update store, try gateway call, revert with prev on error

## 2026-02-08 - US-053
- Created PM dashboard view at `src/routes/projects/+page.svelte` with `+page.ts` (ssr: false)
- Dashboard sections: stats header (projects, tasks, overdue, blocked counts), tasks by status breakdown, due soon (7 days), blocked tasks, in-progress tasks, recent activity feed
- Used parallel loading: `Promise.all([loadStats, loadActivities, loadProjects, loadBlocks])`
- Derived reactive data: `dueSoonTasks`, `blockedTasks`, `inProgressTasks`, `recentActivities`
- Files changed: `src/routes/projects/+page.ts` (new), `src/routes/projects/+page.svelte` (new)
- **Learnings for future iterations:**
  - `as TypeName` casts inside Svelte template expressions cause Prettier parse errors — use helper functions to cast in script block instead
  - `PmBlock` entities track blocking via `blockerId`/`blockedId` — blocked tasks derived from `$pmBlocks` set
  - `statusEntries()` helper converts `Record<string, number>` to typed array to avoid template-level casts
  - Sidebar already has `/projects` link from Phase 3, no sidebar changes needed

## 2026-02-08 - US-054
- Created `src/lib/components/pm/PmSidebar.svelte` — collapsible tree showing Domain → Focus hierarchy
- Created `src/lib/components/pm/index.ts` barrel export
- Features: expand/collapse domains, click to select domain/focus/all, inline create/edit forms, delete with confirmation, reorder via up/down buttons, hover-reveal action buttons
- Uses ConfirmDialog from Phase 3, dispatches `select` event with `{ domainId, focusId }` payload
- Files changed: `src/lib/components/pm/PmSidebar.svelte` (new), `src/lib/components/pm/index.ts` (new)
- **Learnings for future iterations:**
  - `class:hover:bg-slate-700/60` fails Prettier — the `/` in Tailwind opacity modifier breaks Svelte class directive parsing. Use solid colors like `hover:bg-slate-800` instead
  - Tailwind `group/name` nested hover variant works well for focus items inside domain rows
  - Keyboard helpers (Enter/Escape) on inline forms improve UX without adding complexity
