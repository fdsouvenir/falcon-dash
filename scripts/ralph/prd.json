{
	"project": "falcon-dash",
	"branchName": "ralph/phase-5-settings-canvas",
	"description": "Phase 5: Settings Module + Canvas/A2UI — Configuration editor, skills panel, channel status, node list, exec approvals, logs viewer, model list, device management, A2UI web component integration, and canvas iframe.",
	"userStories": [
		{
			"id": "US-062",
			"title": "Settings types and store",
			"description": "Create src/lib/types/settings.ts with types for config schema, skills, nodes, devices, exec approvals, and log entries. Create src/lib/stores/settings.ts with load/mutation functions using gateway.call for config.*, skills.*, nodes.*, logs.tail, etc.",
			"acceptanceCriteria": [
				"ConfigSchema, ConfigSnapshot, ConfigPatchParams types",
				"SkillEntry, SkillStatus types",
				"NodeEntry, NodeCapabilities types",
				"DeviceEntry, DevicePairRequest types",
				"ExecApproval, ExecAllowlistEntry types",
				"LogEntry type with level, message, timestamp, source",
				"Settings store: loadConfig(), patchConfig(), applyConfig(), loadSchema()",
				"Skills store: loadSkills(), enableSkill(), disableSkill()",
				"Nodes store: loadNodes(), describeNode()",
				"Devices store: loadDevices(), approveDevice(), rejectDevice(), revokeDevice()",
				"Logs store: tailLogs() with cursor-based pagination",
				"Barrel exports updated",
				"npm run format passes",
				"npm run check passes with 0 errors"
			],
			"priority": 1,
			"passes": true,
			"notes": "Reference architecture doc §4.1 for available gateway methods: config.get, config.set, config.schema, skills.status, nodes.list, nodes.describe, logs.tail. Exec approvals are managed via config paths."
		},
		{
			"id": "US-063",
			"title": "Settings route and tab navigation",
			"description": "Create src/routes/settings/+page.svelte with tab navigation matching architecture doc §17: Workspace, Information, Skills, Security, Dashboard, Advanced, About. Each tab renders its respective panel component.",
			"acceptanceCriteria": [
				"Route at /settings with ssr: false",
				"Tab bar with: Workspace, Information, Skills, Security, Dashboard, Advanced, About",
				"Active tab highlighting and URL hash tracking (#workspace, #information, etc.)",
				"Each tab renders a placeholder panel (content filled by subsequent stories)",
				"Responsive: horizontal scroll on mobile if tabs overflow",
				"Tailwind dark theme consistent with existing routes",
				"npm run format passes",
				"npm run check passes with 0 errors",
				"npm run build succeeds"
			],
			"priority": 2,
			"passes": true,
			"notes": "Reference architecture doc §17 for the full tab list and purpose of each. Start with placeholder content in each tab — subsequent stories fill them in."
		},
		{
			"id": "US-064",
			"title": "Workspace tab — agent file editor",
			"description": "Implement the Workspace settings tab. Shows the list of workspace definition files (SOUL.md, AGENTS.md, TOOLS.md, USER.md, IDENTITY.md) with preview and edit capabilities. Reuse FilePreview and FileEditor components from Phase 3.",
			"acceptanceCriteria": [
				"List of workspace files with file name, purpose description, and last modified",
				"Click file to preview rendered markdown",
				"Edit button switches to editor mode (reusing FileEditor from Phase 3)",
				"Save writes via PUT /api/workspace/files/:name with hash concurrency",
				"Reset button reverts unsaved changes with confirmation",
				"Success/error toast on save",
				"Files that don't exist yet show 'Create' button instead",
				"npm run format passes",
				"npm run check passes with 0 errors"
			],
			"priority": 3,
			"passes": true,
			"notes": "Known workspace files: SOUL.md, AGENTS.md, TOOLS.md, USER.md, IDENTITY.md, HEARTBEAT.md, BOOTSTRAP.md, MEMORY.md. Reuse components from src/lib/components/files/."
		},
		{
			"id": "US-065",
			"title": "Information tab — gateway status, usage, nodes, sub-agents",
			"description": "Implement the Information settings tab. Shows gateway connection status, uptime, model, session count, token usage/costs, paired nodes list, and sub-agent run history.",
			"acceptanceCriteria": [
				"Gateway status section: connection state, URL, uptime, current model, session count, restart button",
				"Usage section: token counts by provider (input/output/cache), estimated costs",
				"Nodes section: list of paired nodes with status (online/offline), capabilities, last seen",
				"Sub-agents section: active runs with task, model, runtime; recent completed runs with status",
				"Restart button calls gateway restart with confirmation",
				"Auto-refresh usage data on interval (30s)",
				"npm run format passes",
				"npm run check passes with 0 errors"
			],
			"priority": 4,
			"passes": true,
			"notes": "Usage data comes from session status. Nodes from nodes.list. Sub-agents from sessions.list filtered by kind. Gateway status from health() and status() methods."
		},
		{
			"id": "US-066",
			"title": "Skills tab",
			"description": "Implement the Skills settings tab. Shows all installed skills with enabled/disabled status, version, description. Allow enable/disable toggle and configuration editing.",
			"acceptanceCriteria": [
				"List of installed skills from skills.status",
				"Each skill shows: name, version, description, enabled/disabled toggle",
				"Toggle calls skills API to enable/disable",
				"Expand skill to see configuration options",
				"Edit skill config (API keys, preferences) with save",
				"Visual indicator for skills with missing required config (e.g., missing API key)",
				"npm run format passes",
				"npm run check passes with 0 errors"
			],
			"priority": 5,
			"passes": false,
			"notes": "Skills configuration lives in the gateway config under skills.entries. Use config.get/config.patch for skill-specific settings."
		},
		{
			"id": "US-067",
			"title": "Security tab — devices and channels",
			"description": "Implement the Security settings tab. Shows device pairing management (pending requests, approved devices, revoke) and channel connection status (Discord, Slack, etc.).",
			"acceptanceCriteria": [
				"Device pairing section: pending requests with approve/reject buttons",
				"Paired devices list with name, last seen, role, revoke button",
				"Channel status section: each configured channel with connection state",
				"Discord status: connected/disconnected, server name, invite link",
				"Visual indicators: green=connected, red=disconnected, yellow=connecting",
				"Event listeners for device.pair.requested and device.pair.resolved",
				"npm run format passes",
				"npm run check passes with 0 errors"
			],
			"priority": 6,
			"passes": false,
			"notes": "Device events: device.pair.requested, device.pair.resolved. Channel status comes from health snapshot. WhatsApp may need QR login flow — show placeholder for that."
		},
		{
			"id": "US-068",
			"title": "Dashboard tab and Advanced tab",
			"description": "Implement Dashboard settings (theme toggle, notification preferences, compact mode) and Advanced settings (exec approvals allowlist editor, raw gateway config JSON editor with schema validation).",
			"acceptanceCriteria": [
				"Dashboard tab: dark/light/system theme toggle (stored in localStorage)",
				"Dashboard tab: notification enable/disable toggle",
				"Dashboard tab: compact mode toggle",
				"Advanced tab: exec approvals allowlist — view current commands, add new patterns, remove existing",
				"Advanced tab: raw config editor — JSON textarea with syntax highlighting",
				"Advanced tab: config schema reference panel",
				"Advanced tab: apply config button with validation and restart confirmation",
				"About tab: agent name (from IDENTITY.md), OpenClaw version, dashboard version, uptime",
				"npm run format passes",
				"npm run check passes with 0 errors"
			],
			"priority": 7,
			"passes": false,
			"notes": "Theme switching: add a class to <html> element, persist in localStorage, respect prefers-color-scheme. Config editor uses config.get for current, config.schema for validation, config.apply to save."
		},
		{
			"id": "US-069",
			"title": "Live logs viewer",
			"description": "Create src/lib/components/settings/LogsViewer.svelte — a real-time log viewer in the Information tab. Streams gateway logs via logs.tail with filtering, pause/resume, and auto-scroll.",
			"acceptanceCriteria": [
				"Log entries displayed in monospace font with timestamp, level, message",
				"Color coding by level: error=red, warn=yellow, info=default, debug=gray",
				"Level filter dropdown (all, error, warn, info, debug)",
				"Text search filter (client-side filtering of visible entries)",
				"Pause/resume toggle for live streaming",
				"Auto-scroll to bottom when streaming (unless user scrolled up)",
				"Clear button to reset visible log",
				"Max 1000 entries in view (FIFO, oldest dropped)",
				"npm run format passes",
				"npm run check passes with 0 errors"
			],
			"priority": 8,
			"passes": false,
			"notes": "logs.tail returns entries with cursor for pagination. Poll periodically (every 2-3s) with cursor to get new entries. Alternatively use gateway events if available."
		},
		{
			"id": "US-070",
			"title": "A2UI web component integration",
			"description": "Add the openclaw-a2ui-host Lit web component for rendering A2UI payloads. Create src/lib/components/canvas/A2UIHost.svelte wrapper that loads the component, applies messages, and wires the action bridge back to the gateway.",
			"acceptanceCriteria": [
				"A2UI bundle loaded from static/a2ui.bundle.js or CDN",
				"Svelte wrapper component: <A2UIHost messages={messages} on:action={handleAction} />",
				"applyMessages(messages) called when messages prop changes",
				"Action bridge: user interactions in A2UI emit events routed back via gateway",
				"Graceful fallback if A2UI bundle is not available (show placeholder)",
				"Component works inline in chat messages and as standalone panel",
				"npm run format passes",
				"npm run check passes with 0 errors"
			],
			"priority": 9,
			"passes": false,
			"notes": "Reference architecture doc §2.4 and §12. A2UI is a Lit web component — use dynamic import and customElements.whenDefined() pattern. The action bridge routes user clicks/inputs back to the gateway. If bundle isn't available, degrade gracefully."
		},
		{
			"id": "US-071",
			"title": "Canvas iframe and custom apps",
			"description": "Create src/lib/components/canvas/CanvasFrame.svelte for sandboxed HTML canvas iframes. Add custom apps support to the sidebar — agent-created canvases pinned as persistent nav items under Apps.",
			"acceptanceCriteria": [
				"CanvasFrame component: sandboxed iframe to canvas host URL",
				"Sandbox attributes: allow-scripts (no allow-same-origin)",
				"Resize handling: iframe fills container",
				"Custom apps in sidebar: list of pinned canvases under Apps section",
				"Pin/unpin canvas as custom app",
				"Custom app naming (agent-provided or user-editable)",
				"Reorder custom apps",
				"Route for custom apps: /apps/[id]",
				"npm run format passes",
				"npm run check passes with 0 errors",
				"npm run build succeeds",
				"npm run test passes"
			],
			"priority": 10,
			"passes": false,
			"notes": "Reference architecture doc §2.4 and §12. Canvas host URL is http://<host>:18793/__openclaw__/canvas/. Custom apps are stored in localStorage since there's no backend persistence for pinned apps yet."
		}
	]
}
